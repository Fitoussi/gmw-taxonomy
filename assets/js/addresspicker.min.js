jQuery(document).ready(function(e){function t(t){e("#gmw-location-loader").fadeToggle("fast",function(){setTimeout(function(){"bad"==t?e("#gmw-bad-location-message").fadeToggle("fast",function(){e(this).addClass("gmw-location-message")}):e("#gmw-good-location-message").fadeToggle("fast",function(){e(this).addClass("gmw-location-message")})},500)})}function a(){e(".gmw-location-message").fadeToggle("fast",function(){e(this).removeClass("gmw-location-message"),setTimeout(function(){e("#gmw-location-loader").fadeToggle("fast")},500)})}function o(t){e(".gmw-location-message").fadeToggle("fast",function(){e(this).removeClass("gmw-location-message"),"bad"==t?e("#gmw-bad-location-message").fadeToggle("fast",function(){e(this).addClass("gmw-location-message")}):e("#gmw-good-location-message").fadeToggle("fast",function(){e(this).addClass("gmw-location-message")})})}function s(){a(),navigator.geolocation?navigator.geolocation.getCurrentPosition(n,i):alert("Geolocation is not supported by this browser.")}function n(e){var t=e.coords.latitude,a=e.coords.longitude;r(t,a,"yes")}function i(e){switch(e.code){case e.PERMISSION_DENIED:alert("User denied the request for Geolocation"),t("bad");break;case e.POSITION_UNAVAILABLE:alert("Location information is unavailable."),t("bad");break;case e.TIMEOUT:alert("The request to get user location timed out."),t("bad");break;case e.UNKNOWN_ERROR:alert("An unknown error occurred."),t("bad")}}function l(){a();var e=document.getElementById("_wppl_lat").value,t=document.getElementById("_wppl_long").value;r(e,t,"yes")}function r(a,o,s){geocoder=new google.maps.Geocoder;var n=new google.maps.LatLng(a,o);geocoder.geocode({latLng:n,region:"us"},function(n,i){if(i==google.maps.GeocoderStatus.OK){if(n[0]){"yes"==s&&alert("Address successfully returned.");var l=!1;addressf=n[0].formatted_address,e("#_wppl_address").val(addressf),e("#gmw_check_address").val(addressf),e("#_wppl_formatted_address").val(addressf),e("#wppl-addresspicker").val(addressf),e("#_wppl_lat").val(a),e("#gmw_check_lat").val(a),e("#_wppl_long").val(o),e("#gmw_check_long").val(o),document.getElementById("_wppl_street_number").value="",document.getElementById("_wppl_street_name").value="";var r=n[0].address_components;for(x in r){if("street_number"==r[x].types&&void 0!=r[x].long_name&&(l=r[x].long_name,e("#_wppl_street_number").val(l),e("#_wppl_street").val(l)),"route"==r[x].types&&void 0!=r[x].long_name){var d=r[x].long_name;if(e("#_wppl_street_name").val(d),0!=l&&void 0!=l){var _=l+" "+d;e("#_wppl_street").val(_)}else e("#_wppl_street").val(d)}if("locality,political"==r[x].types&&void 0!=r[x].long_name){var m=r[x].long_name;e("#_wppl_city").val(m)}if("administrative_area_level_1,political"==r[x].types){if(void 0!=r[x].short_name){var g=r[x].short_name;e("._wppl_state").val(g)}if(void 0!=r[x].long_name){var c=r[x].long_name;e("._wppl_state_long").val(c)}}if("postal_code"==r[x].types&&void 0!=r[x].long_name){var u=r[x].long_name;e("#_wppl_zipcode").val(u)}if("country,political"==r[x].types){if(void 0!=r[x].short_name){var v=r[x].short_name;e("._wppl_country").val(v)}if(void 0!=r[x].long_name){var f=r[x].long_name;e("._wppl_country_long").val(f)}}}}t("good")}else alert("Geocoder failed due to: "+i),p(),t("bad")})}function d(){a();var o=e("#_wppl_street").val(),s=e("#_wppl_apt").val(),n=e("#_wppl_city").val(),i=e("#_wppl_state").val(),l=e("#_wppl_zipcode").val(),r=e("#_wppl_country").val();document.getElementById("_wppl_street_number").value="",document.getElementById("_wppl_street_name").value="",retAddress=o+" "+n+" "+i+" "+l+" "+r,addressApt=o+" "+s+" "+n+" "+i+" "+l+" "+r,geocoder=new google.maps.Geocoder,geocoder.geocode({address:retAddress},function(a,o){if(o==google.maps.GeocoderStatus.OK){alert("Latitude / Longitude successfully returned"),retLat=a[0].geometry.location.lat(),retLong=a[0].geometry.location.lng(),addressf=a[0].formatted_address,e("#_wppl_lat").val(retLat),e("#_wppl_long").val(retLong),e("#_wppl_address").val(addressApt),e("#_wppl_formatted_address").val(addressf),e("#wppl-addresspicker").val(addressf);var s=a[0].address_components;for(x in s){if("street_number"==s[x].types&&void 0!=s[x].long_name){var n=s[x].long_name;document.getElementById("_wppl_street_number").value=n}if("route"==s[x].types&&void 0!=s[x].long_name){var i=s[x].long_name;document.getElementById("_wppl_street_name").value=i}if("administrative_area_level_1,political"==s[x].types){if(void 0!=s[x].short_name){var l=s[x].short_name;e("._wppl_state").val(l)}if(void 0!=s[x].long_name){var r=s[x].long_name;document.getElementById("_wppl_state_long").value=r}}if("country,political"==s[x].types){if(void 0!=s[x].short_name){var d=s[x].short_name;e("._wppl_country").val(d)}if(void 0!=s[x].long_name){var _=s[x].long_name;document.getElementById("_wppl_country_long").value=_}}}t("good")}else alert("Geocode was not successful for the following reason: "+o),p(),t("bad")})}function p(){e(".gmw-location-manually-wrapper input:text, .gmw-location-section.autocomplete input:text").val("")}var _=gmwSettings.taxonomy_settings.edit_taxonomy_zoom_level;""!=e("#_wppl_lat").val()&&""!=e("#_wppl_long").val()?(initLat=e("#_wppl_lat").val(),initLng=e("#_wppl_long").val()):(initLat=gmwSettings.taxonomy_settings.edit_taxonomy_latitude,initLng=gmwSettings.taxonomy_settings.edit_taxonomy_longitude);e.widget("ui.addresspicker",{options:{appendAddressString:"",draggableMarker:!0,regionBias:null,mapOptions:{zoom:parseInt(_),center:new google.maps.LatLng(initLat,initLng),scrollwheel:!1,mapTypeId:google.maps.MapTypeId.ROADMAP},elements:{map:!1,lat:!1,lng:!1,route:!1,locality:!1,postal_code:!1,country:!1,type:!1}},marker:function(){return this.gmarker},map:function(){return this.gmap},updatePosition:function(){this._updatePosition(this.gmarker.getPosition(),"no")},reloadPosition:function(){this.gmarker.setVisible(!0),this.gmarker.setPosition(new google.maps.LatLng(this.lat.val(),this.lng.val())),this.gmap.setCenter(this.gmarker.getPosition())},selected:function(){return this.selectedResult},_create:function(){this.geocoder=new google.maps.Geocoder,this.element.autocomplete({source:e.proxy(this._geocode,this),focus:e.proxy(this._focusAddress,this),select:e.proxy(this._selectAddress,this)}),this.lat=e(this.options.elements.lat),this.lng=e(this.options.elements.lng),this.street_number=e(this.options.elements.street_number),this.route=e(this.options.elements.route),this.locality=e(this.options.elements.locality),this.administrative_area_level_1=e(this.options.elements.administrative_area_level_1),this.postal_code=e(this.options.elements.postal_code),this.country=e(this.options.elements.country),this.type=e(this.options.elements.type),this.options.elements.map&&(this.mapElement=e(this.options.elements.map),this._initMap())},_initMap:function(){this.lat&&this.lat.val()&&(this.options.mapOptions.center=new google.maps.LatLng(this.lat.val(),this.lng.val())),this.gmap=new google.maps.Map(this.mapElement[0],this.options.mapOptions),this.gmarker=new google.maps.Marker({position:this.options.mapOptions.center,map:this.gmap,draggable:this.options.draggableMarker}),google.maps.event.addListener(this.gmarker,"dragend",e.proxy(this._markerMoved,this)),this.gmarker.setVisible(!1)},_updatePosition:function(e,t,a){"yes"==t&&r(e.lat(),e.lng(),"no"),"yes"==a&&(this.lat&&this.lat.val(e.lat()),this.lng&&this.lng.val(e.lng()))},_markerMoved:function(){a(),e(".gmw-location-section input:text").val(""),e("#gmw-saved-data input:text").val(""),this._updatePosition(this.gmarker.getPosition(),"yes")},_geocode:function(e,t){var a=e.term;this.geocoder.geocode({address:a+this.options.appendAddressString,region:this.options.regionBias},function(e,a){if(a==google.maps.GeocoderStatus.OK)for(var o=0;o<e.length;o++)e[o].label=e[o].formatted_address;t(e)})},_findInfo:function(e,t){for(var a=0;a<e.address_components.length;a++){var o=e.address_components[a];if(-1!=o.types.indexOf(t))return o.short_name}return""},_findInfoLong:function(e,t){for(var a=0;a<e.address_components.length;a++){var o=e.address_components[a];if(-1!=o.types.indexOf(t))return o.long_name}return""},_focusAddress:function(t,a){var o=a.item;e("#_wppl_address").val(o.formatted_address),e("#_wppl_formatted_address").val(o.formatted_address),o&&(this.gmarker&&(this.gmarker.setPosition(o.geometry.location),this.gmarker.setVisible(!0),this.gmap.fitBounds(o.geometry.viewport)),this._updatePosition(o.geometry.location,"no","yes"),this.street_number?(this.street_number.val(this._findInfo(o,"street_number")),e("#_wppl_street_number").val(this._findInfoLong(o,"street_number")),this.route&&(this.route.val(this._findInfo(o,"street_number")+" "+this._findInfo(o,"route")),e("#_wppl_street_name").val(this._findInfoLong(o,"route")))):this.route&&this.route.val(this._findInfo(o,"route")),this.locality&&this.locality.val(this._findInfo(o,"locality")),this.administrative_area_level_1&&(this.administrative_area_level_1.val(this._findInfo(o,"administrative_area_level_1")),e("._wppl_state_long").val(this._findInfoLong(o,"administrative_area_level_1"))),this.postal_code&&this.postal_code.val(this._findInfo(o,"postal_code")),this.country&&(this.country.val(this._findInfo(o,"country")),e("._wppl_country_long").val(this._findInfoLong(o,"country"))),this.type&&this.type.val(o.types[0]))},_selectAddress:function(e,t){this.selectedResult=t.item,o("good")}}),e.extend(e.ui.addresspicker,{version:"@VERSION"}),Array.indexOf||(Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return t;return-1});var m=(jQuery("#addresspicker").addresspicker(),jQuery("#wppl-addresspicker").addresspicker({elements:{map:"#map",lat:"#_wppl_lat",lng:"#_wppl_long",route:"#_wppl_street",locality:"#_wppl_city",administrative_area_level_1:"._wppl_state",postal_code:"#_wppl_zipcode",country:"._wppl_country"}})),g=m.addresspicker("marker");g.setVisible(!0),m.addresspicker("updatePosition"),e("#publish").click(function(t){1==gmwOptions.taxonomy_settings.mandatory_address&&(""==e("#_wppl_lat").val()||""==e("#_wppl_long").val()||""==e("#_wppl_address").val())?(t.preventDefault(t),e(".spinner").hide(),alert("Post cannot be published. You must enter a vallid address. Please make sure that latitude and longitude fields are not empty."),setTimeout(function(){jQuery("#publish").removeClass("button-primary-disabled")},2e3)):(e("#_wppl_lat").removeAttr("disabled"),e("#_wppl_long").removeAttr("disabled"),e("#_wppl_address").removeAttr("disabled"))}),""!=e("#_wppl_lat").val()&&""!=e("#_wppl_long").val()&&""!=e("#_wppl_formatted_address")&&o("good"),e("#gmw-admin-locator-btn").click(function(){p(),s()}),e("#gmw-admin-delete-btn").click(function(){p(),o("bad")}),e("#gmw-admin-getlatlong-btn").click(function(){d()}),e("#gmw-admin-getaddress-btn").click(function(){l()}),jQuery(".metabox-tabs li a").each(function(){var e=jQuery(this).parent().attr("class").replace(/active /,"");"active"!=jQuery(this).attr("class")&&jQuery("div."+e).hide(),jQuery("div."+e).addClass("tab-content"),jQuery(this).click(function(){jQuery(this).parent().parent().parent().children("div").hide(),jQuery(this).parent().parent("ul").find("li.active").removeClass("active"),jQuery("div."+e).show(),jQuery("li."+e).addClass("active")})}),jQuery(".heading").hide(),jQuery(".metabox-tabs").show()});